<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width initial-scale=1">
    <title>CodingPrime</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/highlight.js.solarized.css">
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  </head>
  <body>
    <nav role="navigation" class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand">CodingPrime</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="/">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      <article class="post">
        <header>
          <h2 class="post-title">Moving from Virtualbox to Physical Disk
          </h2>
          <time datetime="2010-08-21 15:50" class="timestamp">August 21, 2010</time>
        </header><p>I decided to convert one of my Gentoo VirtualBox installs to physical disk
(ie. convert Virtual -&gt; Physical ).  This sounded pretty straightforward,
but after a bit of Googling, all I had found were a bunch of articlesi
explaining how to take a physical partition and convert it to a .vdi.  This
was exactly the opposite of what I wanted to do.</p>
<p>Finally, I found <a href="http://wiki.przemoc.net/tips/linux">this</a>
wiki article, and it all came together.</p>
<h3 id="preparing-the-disks">Preparing the disks</h3>
<p>I had a spare SATA drive laying around, so I powered off the machine and popped
it in.  Using my trusty Gentoo install CD, I partitioned the Linux disk.  My
Virtualbox install had a disk layout like this:</p>
<pre><code>/dev/sda1   /boot
/dev/sda2   &lt;swap&gt;
/dev/sda3   /
/dev/sda4   &lt;Extended&gt;
/dev/sda5   /usr
/dev/sda6   /var
</code></pre><p>I basically mirrored that on the Linux drive.  It&#39;s not necessary to be exact,
but make sure each partition has AT LEAST enough space to hold the data you&#39;ll
be moving to it.  I also created one extra partition to hold the .vdi images
temporarily while I got the Linux data extracted.  I would be sure and create
this partition LAST, and at the end of the drive, because once you delete,
renumbering Linux partitions is a pain in the ass.</p>
<h3 id="copying-the-vdi-files">Copying the .vdi files</h3>
<p>Since my windows install is full of games, and reinstalling would be a bitch,
I wanted to get Gentoo copied over and working with my 2 Windows drives
detached from the system to prevent me from accidentally overwriting, say, the
partition table on one of them.</p>
<p>What I did is use the <a href="http://www.fs-driver.org/">IFS driver</a> to mount the
extra partition I created above inside Windows, and copied my 2 Virtualbox
.vdi&#39;s to it (Gentoo.vdi and Gentoo2.vdi).  At this point, I shut down the
machine and disconnected the 2 SATA cables from my Windows drives.  Better safe
than sorry.</p>
<h3 id="copying-the-gentoo-system">Copying the Gentoo system</h3>
<p>Again, I booted the box with the Gentoo install CD in the drive.  It
recognized its HDD as <code>sda</code> (as expected).  Now it was time to start copying
files.  To make things easier, inside the Gentoo LiveCD environment, I made two
directories, <code>/mnt/old</code> and <code>/mnt/new</code>.  The names should be pretty self
explanatory.  Based on the wiki article above, I wrote a little shell script to
make mounting the .vdi partitions easier.  I&#39;ll include the script at the
end of the post.  For instance, to get the /boot partition mounted from the
.vdi image and copied to the new Linux drive:</p>
<pre><code class="hljs bash">saturn-gentoo ~ <span class="hljs-comment"># ./vdi.sh -v /mnt/cdrom/Virtual\ Disks/Gentoo.vdi </span>
PART          OFFSET ID
<span class="hljs-number">1</span>              <span class="hljs-number">65536</span> <span class="hljs-number">83</span>
<span class="hljs-number">2</span>           <span class="hljs-number">34095616</span> <span class="hljs-number">82</span>
<span class="hljs-number">3</span>          <span class="hljs-number">571351552</span> <span class="hljs-number">83</span>
Which partition to you want to mount? (Enter to skip)&gt; <span class="hljs-number">1</span>
Offset: <span class="hljs-number">65536</span>
Enter a mountpoint &gt; /mnt/old
Filesystem <span class="hljs-built_in">type</span> (ex. ext3) &gt; ext2
Mount command:
   mount <span class="hljs-string">"/mnt/cdrom/Virtual Disks/Gentoo.vdi"</span> <span class="hljs-string">"/mnt/old"</span> -t ext2 \
      -o loop,offset=<span class="hljs-number">65536</span>
Execute now? (Yn) &gt; Y
Mount successful
saturn-gentoo ~ <span class="hljs-comment"># mount /dev/sda1 /mnt/new</span>
saturn-gentoo ~ <span class="hljs-comment"># cp -axr /mnt/old/* /mnt/new</span>
saturn-gentoo ~ <span class="hljs-comment"># umount /mnt/old</span>
saturn-gentoo ~ <span class="hljs-comment"># umount /mnt/new</span></code></pre>

<p>Rinse and repeat for the remainder of the partitions.</p>
<h3 id="system-configuration">System configuration</h3>
<p>Since the drive identifier (sda) was the same between VirtualBox and the
physical install, I didn&#39;t have to touch <code>fstab</code> or <code>grub</code>.  I made sure
all partitions were unmounted and rebooted.  With the CD out of the drive, I
was pleasantly surprised to see the Grub prompt, and even more surprised when
everything just booted normally.  I had to do some minimal tweaking to X to
move away from the virtualbox video/input drivers, but other than that, things
Just Worked &reg;.</p>
<h3 id="vdi-script">VDI script</h3>
<p>Here&#39;s the script I used to mount my .vdi partitions.  If anyone finds it
useful, please let me know.</p>
<p><strong>Disclaimer</strong>: This script may wipe out the ozone layer and promote anarchy
among the masses.  Use at your own risk.</p>
<pre><code class="hljs bash"><span class="hljs-shebang">#!/bin/bash</span>
<span class="hljs-comment">#==============================================================================</span>
<span class="hljs-comment"># Copyright 2010 Josh Williams &lt;theprime@codingprime.com&gt;</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># Quick and dirty bash script to handle mounting .vdi images from VirtualBox</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># This program is free software: you can redistribute it and/or modify</span>
<span class="hljs-comment"># it under the terms of the GNU General Public License as published by</span>
<span class="hljs-comment"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="hljs-comment"># (at your option) any later version.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># This program is distributed in the hope that it will be useful,</span>
<span class="hljs-comment"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="hljs-comment"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="hljs-comment"># GNU General Public License for more details.</span>
<span class="hljs-comment">#</span>
<span class="hljs-comment"># You should have received a copy of the GNU General Public License</span>
<span class="hljs-comment"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="hljs-comment">#===============================================================================</span>

TEMP_FILENAME=<span class="hljs-string">'/tmp/vdimage'</span>
VDI_FILENAME=<span class="hljs-string">''</span>
DUMP_ONLY=<span class="hljs-number">0</span>

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Print the script usage information</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">usage</span></span>() {
  cat &lt;&lt; EOF
USAGE: <span class="hljs-variable">$0</span> options FILENAME

OPTIONS:
    -h           Show this message
    -p           Print the VDI partition table and exit.
    -t filename  Override the temporary file (default 
                 is ./vdimage)
    -v filename  Path to the .vdi file
EOF
}

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Print the extracted partition table</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">print_partitions</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"PART          OFFSET ID"</span>
  <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> <span class="hljs-variable">$@</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${part}</span>"</span> | awk -F: <span class="hljs-string">'{printf "%-4s %15s %s\n", $1, $2, $3}'</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Get the partition to be mounted</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">select_partition</span></span>() {
  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    print_partitions <span class="hljs-variable">${valid_partitions[@]}</span>
    <span class="hljs-built_in">read</span> -p <span class="hljs-string">"Which partition to you want to mount? (Enter to skip)&gt; "</span> part_num
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">${part_num}</span>"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">for</span> (( i = <span class="hljs-number">0</span> ; i &lt; <span class="hljs-variable">${#valid_partitions[@]}</span> ; i++ )); <span class="hljs-keyword">do</span>
        part=<span class="hljs-variable">${valid_partitions[i]}</span>
        part_id=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${part}</span>"</span> | awk -F: <span class="hljs-string">'{print $1;}'</span>`
        <span class="hljs-keyword">if</span> [ <span class="hljs-variable">${part_id}</span> == <span class="hljs-variable">$part_num</span> ]; <span class="hljs-keyword">then</span>
          num=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${part}</span>"</span> | awk -F: <span class="hljs-string">'{print $1;}'</span>`
          offset=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${part}</span>"</span> | awk -F: <span class="hljs-string">'{print $2;}'</span>`
          typ_id=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${part}</span>"</span> | awk -F: <span class="hljs-string">'{print $3;}'</span>`

          selected_partition=( <span class="hljs-variable">$num</span> <span class="hljs-variable">$offset</span> <span class="hljs-variable">$typ_id</span> )
          <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">fi</span>
      <span class="hljs-keyword">done</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">${selected_partition}</span>"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">${part_num}</span>"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">break</span>
      <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Invalid partition number: <span class="hljs-variable">${part_num}</span>"</span>
        <span class="hljs-keyword">continue</span>
      <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Get the mountpoint</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">select_mountpoint</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Offset: <span class="hljs-variable">${selected_partition[1]}</span>"</span>
  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">read</span> -p <span class="hljs-string">"Enter a mountpoint &gt; "</span> mountpoint
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">${mountpoint}</span>"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">if</span> [ <span class="hljs-operator">-d</span> <span class="hljs-string">"<span class="hljs-variable">${mountpoint}</span>"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">break</span>
      <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Not a valid directory: <span class="hljs-variable">${mountpoint}</span>"</span>
        <span class="hljs-keyword">continue</span>
      <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Select Filesystem type</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">select_fs_type</span></span>() {
  supported_filesystems=`cat /proc/filesystems | \
    sed <span class="hljs-string">'s/^nodev//'</span> | awk <span class="hljs-string">'{print $1;}'</span>`
  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    valid_fs_<span class="hljs-built_in">type</span>=<span class="hljs-number">0</span>
    <span class="hljs-built_in">read</span> -p <span class="hljs-string">"Filesystem type (ex. ext3) &gt; "</span> fs_<span class="hljs-built_in">type</span>
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$fs_type</span>"</span> ]; <span class="hljs-keyword">then</span>
      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-variable">${supported_filesystems}</span>; <span class="hljs-keyword">do</span>
        <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$i</span> == <span class="hljs-variable">${fs_type}</span> ]]; <span class="hljs-keyword">then</span>
          valid_fs_<span class="hljs-built_in">type</span>=<span class="hljs-number">1</span>
          <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">fi</span>
      <span class="hljs-keyword">done</span>
      <span class="hljs-keyword">if</span> (( <span class="hljs-variable">$valid_fs_type</span> )); <span class="hljs-keyword">then</span>
        <span class="hljs-keyword">break</span>
      <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Filesystem type not supported: <span class="hljs-variable">${fs_type}</span>"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
        fs_<span class="hljs-built_in">type</span>=<span class="hljs-string">""</span>
      <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Handle the actual mounting</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">handle_mount</span></span>() {
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Mount command:"</span>
  cmd=<span class="hljs-string">'mount "'</span><span class="hljs-variable">${VDI_FILENAME}</span><span class="hljs-string">'" "'</span><span class="hljs-variable">${mountpoint}</span><span class="hljs-string">'" -t '</span><span class="hljs-variable">${fs_type}</span><span class="hljs-string">' \
    -o loop,offset='</span><span class="hljs-variable">${selected_partition[1]}</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"   <span class="hljs-variable">${cmd}</span>"</span>
  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">read</span> -p <span class="hljs-string">"Execute now? (Yn) &gt; "</span> answer
    <span class="hljs-keyword">if</span> [ ! -n <span class="hljs-string">"<span class="hljs-variable">${answer}</span>"</span> ]; <span class="hljs-keyword">then</span> answer=<span class="hljs-string">"Y"</span>; <span class="hljs-keyword">fi</span>
    <span class="hljs-keyword">case</span> <span class="hljs-variable">$answer</span> <span class="hljs-keyword">in</span>
    [yY])
      mount <span class="hljs-string">"<span class="hljs-variable">${VDI_FILENAME}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${mountpoint}</span>"</span> -t <span class="hljs-variable">${fs_type}</span> -o \
        loop,offset=<span class="hljs-variable">${selected_partition[1]}</span>
      <span class="hljs-keyword">break</span>
      ;;
    [nN])
      <span class="hljs-keyword">break</span>
      ;;
    *)
      <span class="hljs-built_in">echo</span> <span class="hljs-string">"Invalid response: <span class="hljs-variable">${answer}</span>\n"</span>
      ;;
    <span class="hljs-keyword">esac</span>
  <span class="hljs-keyword">done</span>
}

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Check the arguments</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">getopts</span> <span class="hljs-string">"hv:t:p"</span> OPTION
<span class="hljs-keyword">do</span>
  <span class="hljs-keyword">case</span> <span class="hljs-variable">$OPTION</span> <span class="hljs-keyword">in</span>
    h)
      usage
      <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>
      ;;
    v)
      VDI_FILENAME=<span class="hljs-variable">$OPTARG</span>
      ;;
    t)
      TEMP_FILENAME=<span class="hljs-variable">$OPTARG</span>
      ;;
    p)
      DUMP_ONLY=<span class="hljs-number">1</span>
      ;;
    ?)
      usage
      <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>
      ;;
  <span class="hljs-keyword">esac</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Make sure the .vdi file actually exists</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">if</span> [[ -z <span class="hljs-variable">$VDI_FILENAME</span> ]]; <span class="hljs-keyword">then</span> usage; <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">fi</span>

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Make sure we're dealing with a fixed size image</span>
<span class="hljs-comment">#</span>
fixed=`od -j76 -N4 -td4 <span class="hljs-string">"<span class="hljs-variable">${VDI_FILENAME}</span>"</span> | awk <span class="hljs-string">'NR==1{print 2;}'</span>`
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$fixed</span> != <span class="hljs-string">"2"</span> ]; <span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"Not a fixed disk."</span>; <span class="hljs-keyword">exit</span>; <span class="hljs-keyword">fi</span>

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Find the initial offset</span>
<span class="hljs-comment">#</span>
initial_offset=`od -j344 -N4 -td4 <span class="hljs-string">"<span class="hljs-variable">${VDI_FILENAME}</span>"</span> | awk <span class="hljs-string">'NR==1{print $2;}'</span>`

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Extract the partition table</span>
<span class="hljs-comment">#</span>
dd <span class="hljs-keyword">if</span>=<span class="hljs-string">"<span class="hljs-variable">${VDI_FILENAME}</span>"</span> of=<span class="hljs-variable">${TEMP_FILENAME}</span> bs=<span class="hljs-number">1</span> skip=<span class="hljs-variable">${initial_offset}</span> \
  count=<span class="hljs-number">512</span> &gt;&gt; /dev/null <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>
parts=`sfdisk -luS <span class="hljs-variable">${TEMP_FILENAME}</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | grep -E <span class="hljs-string">"^ ?<span class="hljs-variable">${TEMP_FILENAME}</span>"</span> | \
  sed -E <span class="hljs-string">"s|<span class="hljs-variable">${TEMP_FILENAME}</span>||"</span> | sed <span class="hljs-string">'s/*//'</span> | \
  awk <span class="hljs-string">'{gsub(/ */,"",$1); print $1 ":" $2 ":" $5;}'</span>`

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Cleanup the Temp file</span>
<span class="hljs-comment">#</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-operator">-e</span> <span class="hljs-variable">${TEMP_FILENAME}</span> ]; <span class="hljs-keyword">then</span>
  rm <span class="hljs-variable">${TEMP_FILENAME}</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment">#</span>
<span class="hljs-comment"># Gather the partitions that are valid for mounting</span>
<span class="hljs-comment"># This basically drops anything that is an Extended partition ( Type 5 )</span>
<span class="hljs-comment">#</span>
valid_partitions=( )
<span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> <span class="hljs-variable">$parts</span>; <span class="hljs-keyword">do</span>
  typ_id=`<span class="hljs-built_in">echo</span> <span class="hljs-variable">$part</span> | awk -F: <span class="hljs-string">'{print $3;}'</span>`
  <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">${typ_id}</span>"</span> != <span class="hljs-string">"5"</span> ]; <span class="hljs-keyword">then</span>
    num=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${part}</span>"</span> | awk -F: <span class="hljs-string">'{print $1;}'</span>`
    offset=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${part}</span>"</span> | awk -F: <span class="hljs-string">'{print $2;}'</span>`
    offset=`<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${offset}</span> * 512 + <span class="hljs-variable">$initial_offset</span>"</span> | bc`
    valid_partitions=( <span class="hljs-string">"<span class="hljs-variable">${valid_partitions[@]}</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${num}</span>:<span class="hljs-variable">${offset}</span>:<span class="hljs-variable">${typ_id}</span>"</span> )
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>


<span class="hljs-keyword">if</span> (( <span class="hljs-variable">$DUMP_ONLY</span> )); <span class="hljs-keyword">then</span>
  print_partitions <span class="hljs-variable">${valid_partitions[@]}</span>
<span class="hljs-keyword">else</span>
  <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    selected_partition=<span class="hljs-string">""</span>
    mountpoint=<span class="hljs-string">""</span>
    fs_<span class="hljs-built_in">type</span>=<span class="hljs-string">""</span>

    select_partition

    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">${selected_partition}</span>"</span> ]; <span class="hljs-keyword">then</span>
      select_mountpoint
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">${mountpoint}</span>"</span> ]; <span class="hljs-keyword">then</span>
      select_fs_<span class="hljs-built_in">type</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">${fs_type}</span>"</span> ]; <span class="hljs-keyword">then</span>
      handle_mount
    <span class="hljs-keyword">fi</span>

    <span class="hljs-keyword">if</span> [ ! -n <span class="hljs-string">"<span class="hljs-variable">$fs_type</span>"</span> ]; <span class="hljs-keyword">then</span> <span class="hljs-keyword">break</span>; <span class="hljs-keyword">fi</span>
  <span class="hljs-keyword">done</span>
<span class="hljs-keyword">fi</span></code></pre>

<p>Is it overkill? Yes. But I did it anyway. Next time: getting Windows back into
the mix.</p>

      </article>
    </div>
    <footer class="site-footer">
      <div class="container">
        <h2 class="footer-heading">CodingPrime</h2>
        <div class="footer-col-wrapper">
          <div class="footer-col footer-col-1">
            <ul class="contact-list">
              <li>CodingPrime</li>
              <li><a href="#">site.email_address</a></li>
            </ul>
          </div>
          <div class="footer-col footer-col-2">
            <ul class="social-media-list">
              <li><a href="https://github.com/t3hpr1m3"><span class="icon icon--github">
                    <svg viewBox="0 0 16 16">
                      <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path>
                    </svg></span><span class="username">t3hpr1m3</span></a></li>
              <li><a href="https://twitter.com/t3hpr1m3"><span class="icon icon--twitter">
                    <svg viewBox="0 0 16 16">
                      <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809 c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path>
                    </svg></span><span class="username">t3hpr1m3</span></a></li>
            </ul>
          </div>
          <div class="footer-col footer-col-3">
            <p class="text">Write an awesome description for your new site here. You     can edit this line in _config.yml. It will appear in your document     head meta (for Google search results) and in your feed.xml site   description.</p>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>