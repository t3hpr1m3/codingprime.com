<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CodingPrime</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Inconsolata%7COswald%7COxygen%7CSource+Code+Pro">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/highlight.js.solarized.css">
  </head>
  <body>
    <header>
      <section class="container">
        <h1><a href="/">CodingPrime</a></h1><span>&lt;strong&gt;kung fu&lt;/strong&gt;</span><a href="https://github.com/t3hpr1m3/codingprime.com"><img style="position: absolute; top: 0; right: 0; border: 0" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>
      </section>
    </header>
    <main class="container">
      <article class="post">
        <header>
          <time datetime="2010-08-21 23:20">August 21, 2010</time>
          <h2>Site Config (config.yml) for Rails
          </h2>
        </header>
        <section><p>Over at <a href="http://railscasts.com/">Railscasts</a>, The Honourable Ryan Bates,
Esquire<sup>1</sup> has been churning out quality screencasts FOREVER.  And
while some of them become somewhat obsolete as Rails itself changes, they&#39;re
still a better starting point than most of what&#39;s available on the web.</p>
<p>One that I happened to view recently concerned
<a href="http://railscasts.com/episodes/85-yaml-configuration-file">application configuration</a>
for your Rails app being stored in a <code>.yml</code> file.  This brings site
configuration in line with database, fixtures, etc.  As usual, Ryan gives you
exactly what you need to adapt things to your situation.  So I did.  This is
my ApplicationConfiguration class.<sup>2</sup>  It basically gives you a global
<code>::AppConfig</code> object, which allows you to reverence any of your configuration
settings from a single place.  It supports nested configuration,
and automatically selects the right environment (test, production, etc).</p>
<pre><code class="hljs ruby"><span class="hljs-comment"># config/initializers/_init_app_config.rb</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfigurationNode</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>initialize( data )
    data.each <span class="hljs-keyword">do</span> |k,v|
      <span class="hljs-keyword">self</span>.assign_value( k, v )
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>assign_value( name, val )
    <span class="hljs-keyword">if</span> val.is_a?( <span class="hljs-constant">Hash</span> )
      <span class="hljs-keyword">self</span>.instance_variable_set( <span class="hljs-string">"@<span class="hljs-subst">#{name.to_s}</span>"</span>.to_sym, <span class="hljs-constant">ApplicationConfiguration</span>.new( val ) )
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">self</span>.instance_variable_set( <span class="hljs-string">"@<span class="hljs-subst">#{name.to_s}</span>"</span>.to_sym, val )
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>method_missing( name, *args )
    <span class="hljs-keyword">if</span> name.to_s =~ <span class="hljs-regexp">/(.*)=$/</span>
      <span class="hljs-keyword">self</span>.assign_value( <span class="hljs-variable">$1</span>, args.first )
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.instance_variable_defined?( <span class="hljs-string">"@<span class="hljs-subst">#{name.to_s}</span>"</span>.to_sym )
        <span class="hljs-keyword">self</span>.instance_variable_get( <span class="hljs-string">"@<span class="hljs-subst">#{name.to_s}</span>"</span>.to_sym )
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">nil</span>
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplicationConfiguration</span> <span class="hljs-inheritance">&lt; <span class="hljs-parent">Rails::OrderedOptions</span></span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>initialize
    config_file = <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-constant">RAILS_ROOT</span>}</span>/config/config.yml"</span>
    <span class="hljs-keyword">if</span> <span class="hljs-constant">File</span>.exists?( config_file )
      config_hash = <span class="hljs-constant">YAML</span>.load_file( config_file )
      <span class="hljs-keyword">if</span> config_hash.has_key?( <span class="hljs-constant">RAILS_ENV</span> )
        <span class="hljs-variable">@parameters</span> = <span class="hljs-constant">ApplicationConfigurationNode</span>.new( config_hash[<span class="hljs-constant">RAILS_ENV</span>] )
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> </span>method_missing( name, *args )
    <span class="hljs-variable">@parameters</span>.method_missing( name, args.first )
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-constant">::AppConfig</span> = <span class="hljs-constant">ApplicationConfiguration</span>.new</code></pre>

<p>I put this in <code>config/initializers/_init_app_config.rb</code>, so that it gets loaded
 before everything else, and I&#39;m done.  Now I&#39;m free to add whatever I want to
<code>config.yml</code> and reference it from anywhere in my app.</p>
<pre><code class="hljs ruby"><span class="hljs-comment"># config/config.yml</span>
<span class="hljs-symbol">test:</span>
  <span class="hljs-symbol">harsh:</span>
    <span class="hljs-symbol">theme:</span> <span class="hljs-string">'twilight'</span>
<span class="hljs-symbol">production:</span>
  <span class="hljs-symbol">harsh:</span>
    <span class="hljs-symbol">theme:</span> <span class="hljs-string">'spacecadet'</span></code></pre>

<pre><code class="hljs ruby"><span class="hljs-comment"># app/views/layouts/_stylesheets.html.erb</span>
<span class="hljs-comment"># ...</span>
&lt;%= stylesheet_link_tag <span class="hljs-string">'harsh/<span class="hljs-subst">#{<span class="hljs-constant">::AppConfig</span>.harsh.theme}</span>'</span> %&gt;
<span class="hljs-comment"># ...</span></code></pre>

<p><sup>1</sup>All titles bestowed only by me.  Keep your attorneys to yourself.</p>
<p><sup>2</sup>I know I saw someone doing something similar to this, but for the
 life of me I can&#39;t find it.  If it was you, I apologize for not giving credit.</p>

        </section>
      </article>
      <div id="disqus_thread">
        <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'codingprime'; // required: replace example with your forum shortname
          
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the<a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    </main>
    <footer class="site-footer">
      <section class="container clearfix">
        <p class="text"><span>&copy;2014 Josh Williams</span><a href="https://github.com/t3hpr1m3"><i class="fa fa-github fa-3x"></i></a><a href="https://twitter.com/t3hpr1m3"><i class="fa fa-twitter fa-3x"></i></a></p>
      </section>
    </footer>
  </body>
</html>